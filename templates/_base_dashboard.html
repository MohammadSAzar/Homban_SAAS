{% load static %}
{% load i18n %}
{% load jalali_tags %}
{% load number_converter %}
{% load humanize %}
{% load widget_tweaks %}


<!DOCTYPE html>
<html lang="fa" class="js" dir="rtl">
    <head>
        <!-- Meta -->
        <base href="../" />
        <meta charset="utf-8" />
        <meta name="author" content="" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />

        <!-- CSS -->
        <link rel="stylesheet" href="{% static 'dashboard/assets/css/dashlite.rtl.css' %}" />
        <link id="skin-default" rel="stylesheet" href="{% static 'dashboard/assets/css/theme.css' %}" />
        <link id="skin-default" rel="stylesheet" href="{% static 'dashboard/assets/date_picker/css/persianDatepicker-default.css' %}" />
        <!-- CSS (notification) -->
        <style>
            .notification-badge {
                padding: 0 5px;
                background-color: #00a65c;
                color: white;
            }
        </style>

        <!-- JS -->
        <script src="{% static 'dashboard/assets/js/bundle.js' %}"></script>
        <script src="{% static 'dashboard/assets/js/scripts.js' %}"></script>
        <script src="{% static 'dashboard/assets/js/jquery-3.7.1.min.js' %}"></script>
        <script src="{% static 'dashboard/assets/js/mark.js' %}"></script>
        <script src="{% static 'dashboard/assets/date_picker/js/jquery-1.10.1.min.js' %}"></script>
        <script src="{% static 'dashboard/assets/date_picker/js/persianDatepicker.min.js' %}"></script>
        <!-- JS (notification) -->
        <script>
            setInterval(function() {
                fetch('/api/check-notifications/')
                    .then(response => response.json())
                    .then(data => {
                        if (data.has_new) {
                            new Audio('/dashboard/sounds/notification.mp3').play();
                            location.reload();
                        }
                    });
            }, 60000);
        </script>
        <script>
            if ('Notification' in window && Notification.permission !== 'granted') {
                Notification.requestPermission();
            }
            function showNotification(title, body) {
                if (Notification.permission === 'granted') {
                    new Notification(title, {
                        body: body,
                        icon: '/static/icon.png'
                    });
                }
            }
        </script>

        <!-- Favicon -->
        <link rel="icon" type="image/png" href="{% static 'main/img/logos/ho-fav.png' %}">

        <!-- Title -->
        <title>{% block title %}{% endblock %}</title>
    </head>

    <body class="bg-gray-100 all-projects-template muze-rtl">

        <div class="nk-app-root">
            <div class="nk-main">

                <!-- Sidebar -->
                <div class="nk-sidebar nk-sidebar-fixed" data-content="sidebarMenu">

                    <!-- Logo -->
                    <div class="nk-sidebar-element nk-sidebar-head" style="justify-content: center;">
                        <div class="nk-sidebar-brand">
                            <a href="{% url 'home' %}" class="logo-link nk-sidebar-logo">
                                <img class="logo-light logo-img" src="{% static 'dashboard/images/logos/logo-near-1.png' %}" srcset="{% static 'dashboard/images/logos/logo-near-1.png' %}" alt="لوگو" />
                                <img class="logo-dark logo-img" src="{% static 'dashboard/images/logos/logo-near-1.png' %}" srcset="{% static 'dashboard/images/logos/logo-near-1.png' %}" alt="لوگوی تاریک" />
                            </a>
                        </div>
                        <div class="nk-menu-trigger  me-n2">
                            <a href="#" class="nk-nav-toggle nk-quick-nav-icon d-xl-none" data-target="sidebarMenu"><em class="icon ni ni-arrow-left"></em></a>
                        </div>
                    </div>
                    <!-- end: Logo -->

                    <!-- Sidebar >>> menu -->
                    <div class="nk-sidebar-element">
                        <div class="nk-sidebar-body" data-simplebar>
                            <div class="nk-sidebar-content">
                                <div class="nk-sidebar-menu">

                                    <!-- Sidebar >>> menu >>> items -->
                                    <ul class="nk-menu">

                                        <!-- Main -->
                                        <li class="nk-menu-item has-sub">
                                            <a href="{% url 'dashboard' %}" class="nk-menu-link">
                                                <span class="nk-menu-icon"><em class="icon ni ni-tile-thumb"></em></span>
                                                <span class="nk-menu-text">{% trans 'Dashboard First Page' %}</span>
                                            </a>
                                        </li>

                                        <!-- Locations -->
                                        <li class="nk-menu-item has-sub">
                                            <a href="{% url 'location_list' %}" class="nk-menu-link">
                                                <span class="nk-menu-icon"><em class="icon ni ni-location"></em></span>
                                                <span class="nk-menu-text">{% trans 'Locations' %}</span>
                                            </a>
                                        </li>

                                        <!-- Files -->
                                        <li class="nk-menu-item has-sub">
                                            <a href="#" class="nk-menu-link nk-menu-toggle">
                                                <span class="nk-menu-icon"><em class="icon ni ni-file"></em></span>
                                                <span class="nk-menu-text">{% trans 'Files' %}</span>
                                            </a>
                                            <ul class="nk-menu-sub">
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'sale_file_list' %}" class="nk-menu-link"><span class="nk-menu-text">{% trans 'Sale Files' %}</span></a>
                                                </li>
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'rent_file_list' %}" class="nk-menu-link"><span class="nk-menu-text">{% trans 'Rent Files' %}</span></a>
                                                </li>
                                            </ul>
                                        </li>

                                        <!-- People -->
                                        <li class="nk-menu-item has-sub">
                                            <a href="#" class="nk-menu-link nk-menu-toggle">
                                                <span class="nk-menu-icon"><em class="icon ni ni-users"></em></span>
                                                <span class="nk-menu-text">{% trans 'People' %}</span>
                                            </a>
                                            <ul class="nk-menu-sub">
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'buyer_list' %}" class="nk-menu-link"><span class="nk-menu-text">{% trans 'Buyers' %}</span></a>
                                                </li>
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'renter_list' %}" class="nk-menu-link"><span class="nk-menu-text">مستاجران</span></a>
                                                </li>
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'person_list' %}" class="nk-menu-link"><span class="nk-menu-text">{% trans 'Persons' %}</span></a>
                                                </li>
                                            </ul>
                                        </li>

                                        <!-- Services -->
                                        <li class="nk-menu-item has-sub">
                                            <a href="#" class="nk-menu-link nk-menu-toggle">
                                                <span class="nk-menu-icon"><em class="icon ni ni-ticket"></em></span>
                                                <span class="nk-menu-text">{% trans 'Services' %}</span>
                                            </a>
                                            <ul class="nk-menu-sub">
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'session_list' %}" class="nk-menu-link"><span class="nk-menu-text">{% trans 'Sessions' %}</span></a>
                                                </li>
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'trade_list' %}" class="nk-menu-link"><span class="nk-menu-text">{% trans 'Trades' %}</span></a>
                                                </li>
                                            </ul>
                                        </li>

                                        <!-- Management -->
                                        {% if request.user.title == 'bs' %}
                                            <li class="nk-menu-item has-sub">
                                                <a href="#" class="nk-menu-link nk-menu-toggle">
                                                    <span class="nk-menu-icon"><em class="icon ni ni-users"></em></span>
                                                    <span class="nk-menu-text">مدیریت</span>
                                                </a>
                                                <ul class="nk-menu-sub">
                                                    <li class="nk-menu-item">
                                                        <a href="{% url 'boss_task_list' %}" class="nk-menu-link"><span class="nk-menu-text">وظایف مدیر</span></a>
                                                    </li>
                                                    <li class="nk-menu-item">
                                                        <a href="{% url 'delete_request_list' %}" class="nk-menu-link"><span class="nk-menu-text">موارد حذفی</span></a>
                                                    </li>
                                                </ul>
                                            </li>
                                        {% endif %}

                                        <!-- Calendar -->
                                        <li class="nk-menu-item has-sub">
                                            <a href="#" class="nk-menu-link nk-menu-toggle">
                                                <span class="nk-menu-icon"><em class="icon ni ni-calender-date"></em></span>
                                                <span class="nk-menu-text">تقویم</span>
                                            </a>
                                            <ul class="nk-menu-sub">
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'current_month' %}" class="nk-menu-link"><span class="nk-menu-text">تقویم</span></a>
                                                </li>
                                            </ul>
                                        </li>

                                        <!-- Marked -->
                                        <li class="nk-menu-item has-sub">
                                            <a href="#" class="nk-menu-link nk-menu-toggle">
                                                <span class="nk-menu-icon"><em class="icon ni ni-save"></em></span>
                                                <span class="nk-menu-text">نشان‌شده‌ها</span>
                                            </a>
                                            <ul class="nk-menu-sub">
                                                {% if request.user.title == 'bs' or request.user.title == 'bt' or request.user.title == 'fp' %}
                                                    <li class="nk-menu-item">
                                                        <a href="{% url 'sale_file_marks' %}" class="nk-menu-link"><span class="nk-menu-text">فایل‌های فروش</span></a>
                                                    </li>
                                                {% endif %}
                                                {% if request.user.title == 'bs' or request.user.title == 'bt' or request.user.title == 'fp' %}
                                                    <li class="nk-menu-item">
                                                        <a href="{% url 'rent_file_marks' %}" class="nk-menu-link"><span class="nk-menu-text">فایل‌های اجاره</span></a>
                                                    </li>
                                                {% endif %}
                                                {% if request.user.title == 'bs' or request.user.title == 'bt' or request.user.title == 'cp' %}
                                                    <li class="nk-menu-item">
                                                        <a href="{% url 'buyer_marks' %}" class="nk-menu-link"><span class="nk-menu-text">خریداران</span></a>
                                                    </li>
                                                {% endif %}
                                                {% if request.user.title == 'bs' or request.user.title == 'bt' or request.user.title == 'cp' %}
                                                    <li class="nk-menu-item">
                                                        <a href="{% url 'renter_marks' %}" class="nk-menu-link"><span class="nk-menu-text">مستاجران</span></a>
                                                    </li>
                                                {% endif %}
                                            </ul>
                                        </li>

                                        <!-- Search -->
                                        <li class="nk-menu-item has-sub">
                                            <a href="#" class="nk-menu-link nk-menu-toggle">
                                                <span class="nk-menu-icon"><em class="icon ni ni-search"></em></span>
                                                <span class="nk-menu-text">جستجوی سریع</span>
                                            </a>
                                            <ul class="nk-menu-sub">
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'search_sale_files' %}" class="nk-menu-link"><span class="nk-menu-text">فایل‌های فروش</span></a>
                                                </li>
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'search_rent_files' %}" class="nk-menu-link"><span class="nk-menu-text">فایل‌های اجاره</span></a>
                                                </li>
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'search_buyers' %}" class="nk-menu-link"><span class="nk-menu-text">خریداران</span></a>
                                                </li>
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'search_renters' %}" class="nk-menu-link"><span class="nk-menu-text">مستاجران</span></a>
                                                </li>
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'code_finder' %}" class="nk-menu-link"><span class="nk-menu-text">جستجو با کد</span></a>
                                                </li>
                                            </ul>
                                        </li>

                                        <!-- Interaction -->
                                        <li class="nk-menu-item has-sub">
                                            <a href="#" class="nk-menu-link nk-menu-toggle" style="position: relative;">
                                                <span class="nk-menu-icon"><em class="icon ni ni-chat"></em></span>
                                                <span class="nk-menu-text">تعامل</span>
                                                {% if has_unread_notifications %}
                                                    <span class="notification-badge">{{ total_unread_count|farsi_number }}</span>
                                                {% endif %}
                                            </a>
                                            <ul class="nk-menu-sub">
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'announcement_list' %}" class="nk-menu-link">
                                                        <span class="nk-menu-text">اعلان‌ها</span>
                                                        {% if unread_announcements_count > 0 %}
                                                            <span class="notification-badge">{{ unread_announcements_count|farsi_number }}</span>
                                                        {% endif %}
                                                    </a>
                                                </li>
                                                <li class="nk-menu-item">
                                                    <a href="{% url 'interaction_list' %}" class="nk-menu-link">
                                                        <span class="nk-menu-text">تعامل‌ها</span>
                                                        {% if unread_interactions_count > 0 %}
                                                            <span class="notification-badge">{{ unread_interactions_count|farsi_number }}</span>
                                                        {% endif %}
                                                    </a>
                                                </li>
                                            </ul>
                                        </li>

                                    </ul>
                                    <!-- end:Sidebar >>> menu >>> items -->

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end: Sidebar >>> menu -->

                </div>
                <!-- end: Sidebar -->

                <!-- Header & Content -->
                <div class="nk-wrap">

                    <!-- Header -->
                    <div class="nk-header  nk-header-fixed is-light">
                        <div class="container-fluid">
                            <div class="nk-header-wrap">

                                <!-- 3-lines menu button -->
                                <div class="nk-menu-trigger d-xl-none ms-n1">
                                    <a href="#" class="nk-nav-toggle nk-quick-nav-icon" data-target="sidebarMenu"><em class="icon ni ni-menu"></em></a>
                                </div>

                                <!-- Logo -->
                                <div class="nk-header-brand d-xl-none">
                                    <a href="{% url 'home' %}" class="logo-link">
                                        <img class="logo-light logo-img" src="{% static 'dashboard/images/logos/logo-near-1.png' %}" srcset="{% static 'dashboard/images/logos/logo-near-1.png' %}" alt="لوگو" />
                                        <img class="logo-dark logo-img" src="{% static 'dashboard/images/logos/logo-near-1.png' %}" srcset="{% static 'dashboard/images/logos/logo-near-1.png' %}" alt="لوگوی تاریک" />
                                    </a>
                                </div>

                                <!-- Name & Exit -->
                                <div class="nk-header-tools">
                                    <ul class="nk-quick-nav">
                                        <li class="dropdown user-dropdown">

                                            <!-- Name -->
                                            <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown">
                                                <div class="user-toggle">
                                                    {% if user.name_family %}
                                                        <div class="user-name dropdown-indicator" style="font-size: 1em; padding-top: 0.5em;">{{ user.name_family }} / {{ user.sub_district }}</div>
                                                    {% else %}
                                                        <div class="user-name dropdown-indicator" style="font-size: 1em; padding-top: 0.5em;">{{ user.get_title_display }} / {{ user.sub_district }}</div>
                                                    {% endif %}
                                                </div>
                                            </a>

                                            <!-- Exit -->
                                            <div class="dropdown-menu dropdown-menu-md dropdown-menu-end dropdown-menu-s1">
                                                <div class="dropdown-inner">
                                                    <ul class="link-list">
                                                        <li>
                                                            <form action="{% url 'logout' %}" method="post">
                                                                {% csrf_token %}
                                                                <button type="submit" style="background-color: white; border: none;"><em class="icon ni ni-signout" style="margin-left: 1.5em;"></em>{% trans 'Exit' %}</button>
                                                            </form>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>

                                        </li>
                                    </ul>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- end: Header -->

                    <!-- Content -->
                    <div class="nk-content">
                        <div class="container-fluid">
                            <div class="nk-content-inner">

                                <!-- Main content -->
                                <div class="nk-content-body">
                                    {% block content %}

                                    {% endblock %}
                                </div>
                                <!-- end: Main content -->

                            </div>
                        </div>
                    </div>
                    <!-- end: Content -->

                </div>
                <!-- end: Header & Content -->

            </div>
        </div>

    </body>

</html>


