{% extends '_base_dashboard.html' %}

{% load static %}
{% load i18n %}
{% load jalali_tags %}
{% load jalali_date_converter %}
{% load number_converter %}
{% load price_converter %}
{% load humanize %}
{% load widget_tweaks %}
{% load pagination %}


{% block title %}اعلانات{% endblock %}


{% block content %}
    
    <!-- Main -->
    <div class="nk-block">
        <div class="row gy-4">
    
            <!-- Upper -->
            <div class="col-lg-12">
                <div class="card card-bordered">
                    <div class="card-inner">
                        <div class="card-title-group align-start mb-3">
                            <div class="card-title" style="margin-bottom: 1em;">
                                <h5 class="title" style="font-size: 1.3em;">اعلانات</h5>
                            </div>
                            {% if unviewed_count > 0 %}
                            <div class="card-tools">
                                <span class="badge badge-dim bg-danger" style="font-size: 1em; padding: 8px 15px; font-family: Estedad">
                                    {{ unviewed_count|farsi_number }} مورد جدید
                                </span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- end: Upper -->
    
            <!-- Announcements -->
            <div class="col-lg-12">
                <div class="card card-bordered">
                    <div class="card-inner">
                        
                        {% if announcements %}
                            {% for announcement in announcements %}
                                <div style="border: 1px solid #dbdfea; border-radius: 4px; padding: 20px; margin-bottom: 20px; 
                                            {% if request.user not in announcement.datetime_viewed.all %}background-color: #E3F2FD;{% else %}background-color: #f5f6fa;{% endif %}">
                                    
                                    <!-- Upper -->
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #dbdfea;">
                                        <div style="flex: 1;">
                                            <span style="font-weight: bold; color: #364a63; font-size: 1.1em;">
                                                {% if announcement.announcement_type == 'sf' %}
                                                    <em class="icon ni ni-home-alt" style="font-size: 1.2em;"></em> فایل فروش جدید
                                                {% elif announcement.announcement_type == 'rf' %}
                                                    <em class="icon ni ni-key" style="font-size: 1.2em;"></em> فایل اجاره جدید
                                                {% elif announcement.announcement_type == 'by' %}
                                                    <em class="icon ni ni-user-check" style="font-size: 1.2em;"></em> خریدار جدید
                                                {% elif announcement.announcement_type == 'rt' %}
                                                    <em class="icon ni ni-users" style="font-size: 1.2em;"></em> مستاجر جدید
                                                {% endif %}
                                            </span>
                                            {% if request.user not in announcement.viewed_by.all %}
                                                <span class="badge badge-dim bg-primary" style="margin-right: 10px; font-family: Estedad">جدید</span>
                                            {% endif %}
                                        </div>
                                        <div style="text-align: left;">
                                            <small style="color: #526484;">{{ announcement.datetime_created|to_jalali:'%Y/%m/%d - %H:%M'|farsi_number }}</small>
                                        </div>
                                    </div>
        
                                    <!-- Info -->
                                    <div class="row gy-3 mb-3">
                                        <div class="col-lg-6 col-sm-6">
                                            <strong style="color: #526484;">ایجاد شده توسط:</strong> 
                                            <span style="color: #364a63;">{{ announcement.created_by.name_family|default:announcement.created_by }}</span>
                                        </div>
                                        <div class="col-lg-6 col-sm-6">
                                            <strong style="color: #526484;">نوع:</strong> 
                                            <span style="color: #364a63;">{{ announcement.get_announcement_type_display }}</span>
                                        </div>
                                    </div>
        
                                    <!-- Action Button -->
                                    <div style="text-align: left;">
                                        <a href="{% url 'announcement_detail' announcement.pk %}" target="_blank" class="btn btn-primary">
                                            <em class="icon ni ni-eye"></em>
                                            <span>مشاهده جزئیات و ارائه پیشنهادات</span>
                                        </a>
                                    </div>
        
                                </div>
                            {% endfor %}
    
                            <!-- Pagination -->
                            {% if is_paginated %}
                                <div class="card-inner">
                                    <ul class="pagination justify-content-center justify-content-md-start">
                                        {% if page_obj.has_previous %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">قبلی</a>
                                        </li>
                                        {% endif %}
                                        
                                        <li class="page-item active">
                                            <span class="page-link">{{ page_obj.number|farsi_number }} از {{ page_obj.paginator.num_pages|farsi_number }}</span>
                                        </li>
                                        
                                        {% if page_obj.has_next %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">بعدی</a>
                                        </li>
                                        {% endif %}
                                    </ul>
                                </div>
                            {% endif %}
    
                        {% else %}
                            <div class="alert alert-info" style="text-align: center;">
                                <em class="icon ni ni-info" style="font-size: 2em;"></em>
                                <p style="margin-top: 10px;">هیچ اعلانی موجود نیست.</p>
                            </div>
                        {% endif %}
    
                    </div>
                </div>
            </div>
            <!-- end: Announcements -->
    
        </div>
    </div>
    <!-- end: Main -->
    
{% endblock %}


